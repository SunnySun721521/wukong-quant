<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é‚®ä»¶é…ç½®æµ‹è¯•</title>
</head>
<body>
    <h1>é‚®ä»¶é…ç½®æµ‹è¯•</h1>
    
    <div>
        <label>é‚®ä»¶å‘é€åŠŸèƒ?</label>
        <select id="emailEnabled">
            <option value="false">ç¦ç”¨</option>
            <option value="true">å¯ç”¨</option>
        </select>
    </div>
    
    <div>
        <label>å‘é€é‚®ç®±åœ°å€:</label>
        <input type="text" id="senderEmail">
    </div>
    
    <div>
        <label>é‚®ç®±æˆæƒç ?</label>
        <input type="password" id="senderAuthCode">
    </div>
    
    <div>
        <label>é‚®ä»¶æ¨¡æ¿:</label>
        <select id="emailTemplate">
            <option value="simple">ç®€æ´ç‰ˆ</option>
            <option value="detailed">è¯¦ç»†ç‰?/option>
        </select>
    </div>
    
    <button onclick="loadEmailConfig()">åŠ è½½é…ç½®</button>
    <button onclick="saveEmailConfig()">ä¿å­˜é…ç½®</button>
    
    <div id="result"></div>
    
    <script>
        function loadEmailConfig() {
            fetch('/api/email/config')
                .then(response => response.json())
                .then(data => {
                    console.log('åŠ è½½é…ç½®å“åº”:', data);
                    if (data.error) {
                        console.error('åŠ è½½é‚®ä»¶é…ç½®å¤±è´¥:', data.error);
                        document.getElementById('result').innerHTML = 'åŠ è½½å¤±è´¥: ' + data.error;
                    } else {
                        const config = data;
                        console.log('é…ç½®å¯¹è±¡:', config);
                        document.getElementById('emailEnabled').value = config.enabled ? 'true' : 'false';
                        document.getElementById('senderEmail').value = config.sender_email || '';
                        document.getElementById('senderAuthCode').value = config.sender_auth_code || '';
                        document.getElementById('emailTemplate').value = config.email_body_template || 'simple';
                        document.getElementById('result').innerHTML = 'é…ç½®åŠ è½½æˆåŠŸ<br>' + 
                            'enabled: ' + config.enabled + '<br>' +
                            'sender_email: ' + config.sender_email;
                    }
                })
                .catch(error => {
                    console.error('åŠ è½½é‚®ä»¶é…ç½®å¤±è´¥:', error);
                    document.getElementById('result').innerHTML = 'åŠ è½½å¤±è´¥: ' + error;
                });
        }
        
        function saveEmailConfig() {
            const config = {
                enabled: document.getElementById('emailEnabled').value === 'true',
                sender_email: document.getElementById('senderEmail').value,
                sender_auth_code: document.getElementById('senderAuthCode').value,
                email_body_template: document.getElementById('emailTemplate').value
            };
            
            console.log('ä¿å­˜é…ç½®:', config);
            
            fetch('/api/email/config', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(config)
            })
            .then(response => response.json())
            .then(data => {
                console.log('ä¿å­˜é…ç½®å“åº”:', data);
                if (data.error) {
                    document.getElementById('result').innerHTML = 'ä¿å­˜å¤±è´¥: ' + data.error;
                } else {
                    document.getElementById('result').innerHTML = 'é…ç½®ä¿å­˜æˆåŠŸ';
                }
            })
            .catch(error => {
                console.error('ä¿å­˜é‚®ä»¶é…ç½®å¤±è´¥:', error);
                document.getElementById('result').innerHTML = 'ä¿å­˜å¤±è´¥: ' + error;
            });
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é…ç½?        window.onload = loadEmailConfig;
    </script>
</body>
</html>
