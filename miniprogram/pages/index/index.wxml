<view class="container">
  <view class="header">
    <text class="title">量化交易系统</text>
    <text class="subtitle">智能投资组合分析</text>
    <text class="settings-btn" bindtap="navigateToSettings">⚙ 设置</text>
  </view>

  <view class="portfolio-section" wx:if="{{portfolioResult}}">
    <view class="portfolio-header">
      <text class="portfolio-title">组合总体表现</text>
      <text class="portfolio-date">{{portfolioResult.start_date}} 至 {{portfolioResult.end_date}}</text>
    </view>

    <view class="portfolio-stats">
      <view class="stat-item">
        <text class="stat-label">初始资金</text>
        <text class="stat-value">{{portfolioResult.initial_cash}}</text>
      </view>

      <view class="stat-item">
        <text class="stat-label">最终价值</text>
        <text class="stat-value">{{portfolioResult.final_value}}</text>
      </view>

      <view class="stat-item">
        <text class="stat-label">总收益率</text>
        <text class="stat-value {{portfolioResult.total_return >= 0 ? 'positive' : 'negative'}}">
          {{portfolioResult.total_return >= 0 ? '+' : ''}}{{portfolioResult.total_return}}%
        </text>
      </view>

      <view class="stat-item">
        <text class="stat-label">最大回撤</text>
        <text class="stat-value">{{portfolioResult.max_drawdown}}%</text>
      </view>

      <view class="stat-item">
        <text class="stat-label">总交易次数</text>
        <text class="stat-value">{{portfolioResult.total_trades}}</text>
      </view>

      <view class="stat-item">
        <text class="stat-label">胜率</text>
        <text class="stat-value">{{portfolioResult.win_rate}}%</text>
      </view>
    </view>
  </view>

  <view class="stocks-section" wx:if="{{portfolioResult && portfolioResult.individual_results}}">
    <view class="stocks-header">
      <text class="stocks-title">个股表现</text>
    </view>

    <view class="stock-list">
      <view class="stock-card" wx:for="{{portfolioResult.individual_results}}" wx:key="symbol">
        <view class="stock-header">
          <view class="stock-info">
            <text class="stock-symbol">{{item.symbol}}</text>
            <text class="stock-name">{{stockNames[item.symbol]}}</text>
          </view>
          <text class="stock-return {{item.total_return >= 0 ? 'positive' : 'negative'}}">
            {{item.total_return >= 0 ? '+' : ''}}{{item.total_return}}%
          </text>
        </view>

        <view class="stock-stats">
          <view class="stock-stat">
            <text class="stock-stat-label">最新价</text>
            <text class="stock-stat-value">{{stockRealtimeData[item.symbol] ? (stockRealtimeData[item.symbol].price || '--') : '--'}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">今开</text>
            <text class="stock-stat-value">{{stockRealtimeData[item.symbol] ? (stockRealtimeData[item.symbol].open || '--') : '--'}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">涨跌幅</text>
            <text class="stock-stat-value {{stockRealtimeData[item.symbol] && stockRealtimeData[item.symbol].change >= 0 ? 'positive' : 'negative'}}">
              {{stockRealtimeData[item.symbol] ? ((stockRealtimeData[item.symbol].change >= 0 ? '+' : '') + (stockRealtimeData[item.symbol].change || '--') + '%') : '--'}}
            </text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">成交量</text>
            <text class="stock-stat-value">{{stockRealtimeData[item.symbol] ? (stockRealtimeData[item.symbol].volume || '--') : '--'}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">初始资金</text>
            <text class="stock-stat-value">{{item.initial_cash}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">最终价值</text>
            <text class="stock-stat-value">{{item.final_value}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">最大回撤</text>
            <text class="stock-stat-value">{{item.max_drawdown}}%</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">夏普比率</text>
            <text class="stock-stat-value">{{item.sharpe_ratio}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">交易次数</text>
            <text class="stock-stat-value">{{item.total_trades}}</text>
          </view>

          <view class="stock-stat">
            <text class="stock-stat-label">胜率</text>
            <text class="stock-stat-value">{{item.win_rate}}%</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <view class="loading-section" wx:if="{{loading && !portfolioResult}}">
    <view class="loading-spinner"></view>
    <text class="loading-text">加载中...</text>
  </view>

  <view class="empty-section" wx:if="{{!loading && !portfolioResult}}">
    <text class="empty-text">暂无数据</text>
  </view>
</view>